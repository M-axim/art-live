"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(a){var o=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(a);return _possibleConstructorReturn(this,o?(t=_getPrototypeOf(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var o=e[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}var DB,Form,submitHouseForm,submitPhotoForm,btnNewHouse,btnAddPhoto,submitForm,btnSubmit,teacherCards,InfoBlock=function(){function i(t,e,a,o,n){_classCallCheck(this,i),this.title=t,this.subTitle=e,this.addTitle=a,this.editTitle=o,this.url=n}return _createClass(i,[{key:"col",value:function(t){$.ajax({url:this.url+"?id=".concat(t),method:"get",dataType:"json",async:!1,success:function(t){t.forEach(function(t){$("[data-house__item=".concat(t.id,"] .house__item-edit")).each(function(t,e){var a=$(e).attr("data-edit");"imageURL"!==a&&$("#addForm #".concat(a)).val(e.innerHTML)})})}})}},{key:"delete",value:function(t){$.ajax({url:this.url+"?id=".concat(t),method:"delete",dataType:"json",async:!1,success:function(){}})}},{key:"new",value:function(t,e){$.ajax({url:this.url+"?id=".concat(e),method:"post",async:!1,processData:!1,contentType:!1,data:t,success:function(){}})}},{key:"setImg",value:function(t){$.ajax({url:this.url,method:"post",async:!1,processData:!1,contentType:!1,data:t,success:function(){}})}},{key:"editCol",value:function(t){$.ajax({url:this.url,method:"patch",async:!1,data:JSON.stringify(t),processData:!1,success:function(){},error:function(){}})}},{key:"cols",get:function(){$.ajax({url:this.url,method:"get",dataType:"json",async:!1,success:function(t){var e=$(".house");e.text(""),t.forEach(function(t){e.append('                    \n                    <div class="house__item" data-house__item="'.concat(t.id,'">\n                    <div class="house__action">\n                        <button class="house__action-btn house__action-delete" data-MasterCourse-id="').concat(t.id,'"><img src="img/icon/delete.png" alt=""></button>\n                        <button class="house__action-btn house__action-edit" data-MasterCourse-id="').concat(t.id,'"><img src="img/icon/edit.png" alt=""></button>\n                        <button class="house__action-btn house__action-add" data-MasterCourse-id="').concat(t.id,'"><img src="img/icon/add-photo.png" alt=""></button>\n                    </div>\n                    <div class="house__item-block"></div>\n                    <div class="house__item-img house__item-edit" id="photo-').concat(t.id,'" data-edit="imageURL" data-img="').concat(t.imageURL,'" style="background-image: url(\'img/').concat(t.imageURL,'\')"></div>\n                    <div class="overlay"></div>\n\n                    <div class="house__item-tags">\n                        <div class="house__item-title house__item-edit" data-edit="title">').concat(t.title,'</div>\n                        <div class="house__item-tag house__item-edit" data-edit="tags_1">').concat(t.tags_1,'</div>\n                        <div class="house__item-tag house__item-edit" data-edit="tags_2">').concat(t.tags_2,'</div>\n                        <div class="house__item-tag house__item-edit" data-edit="tags_3">').concat(t.tags_3,'</div>\n                    </div>\n                    <div class="house__item-text house__item-edit" data-edit="text">').concat(t.text,"</div>\n                </div>"))})}})}},{key:"form",get:function(){$("#modal").append('\n                <form action="" method="POST" class="my-modal__form" id="addForm" data-info-id="0" enctype="multipart/form-data">\n                <label for="title" class="my-modal__label">\n                    <input type="text" name="title" placeholder="Введите заголовок блока" required id="title" class="my-modal__line">\n                </label>\n                <label for="tags_1" class="my-modal__label">\n                    <input type="text" name="tags_1" placeholder="Введите первый тег" required id="tags_1" class="my-modal__line">\n                </label>\n                <label for="tags_2" class="my-modal__label">\n                    <input type="text" name="tags_2" placeholder="Введите второй тег" id="tags_2" class="my-modal__line">\n                </label>\n                <label for="tags_3" class="my-modal__label">\n                    <input type="text" name="tags_3" placeholder="Введите третий тег" id="tags_3" class="my-modal__line">\n                </label>\n                <label for="text" class="my-modal__label">\n                    <input type="text" name="text" placeholder="Введите текст обратной стороны карточки" required id="text" class="my-modal__line">\n                </label>\n                <label for="imageURL" class="my-modal__label my-modal__file">\n                    Загрузите фото\n                    <input type="file" name="imageURL" placeholder="Введите путь до изображения" id="imageURL" class="mt-2">\n                </label>\n                <div class="my-modal__action">\n                    <button type="submit" class="btn" id="newHouse">Отправить</button>\n                    <button type="submit" class="btn btn-hidden" id="editHouse">Отправить</button>\n                </div>\n            </form>'),$("#modal").append('\n            <form action="" method="POST" class="my-modal__form" id="addPhotoForm" data-info-id="0" enctype="multipart/form-data">\n                <label for="imageURL" class="my-modal__label my-modal__file">\n                    Загрузите фото\n                    <input type="file" name="imageURL" placeholder="Введите путь до изображения" id="imageURL" class="mt-2">\n                </label>\n                <div class="my-modal__action">\n                    <button type="submit" class="btn" id="newPhoto">Отправить</button>\n                </div>\n            </form>')}}]),i}(),SubmitForm=function(){function a(t,e){_classCallCheck(this,a),this.submitTitle=t,this.submitType=e}return _createClass(a,[{key:"submit",value:function(t){$.ajax({url:"../api/record.php",method:"post",async:!1,processData:!1,contentType:!1,data:t,success:function(){}})}},{key:"form",get:function(){return'<form action="" method="post" class="my-modal__form" id="submitForm" data-submit-type="'.concat(this.submitType,'">\n                <label for="secondName" class="my-modal__label">\n                    <input type="text" name="secondName" placeholder="Введите вашу фамилию" required id="secondName" class="my-modal__line">\n                </label>\n                <label for="name" class="my-modal__label">\n                    <input type="text" name="name" placeholder="Введите ваше имя"  required id="name" class="my-modal__line">\n                </label>\n                <label for="lastName" class="my-modal__label">\n                    <input type="text" name="lastName" placeholder="Введите ваше отчество" required id="lastName" class="my-modal__line">\n                </label>\n                <label for="telephone" class="my-modal__label">\n                    <input type="tel" name="tel" placeholder="Введите ваш номер телефона" required id="telephone" minlength="11" maxlength="11" class="my-modal__line">\n                </label>\n                <label for="masterCourses" class="my-modal__label">\n                    <input type="text" name="masterCourses" placeholder="').concat(this.submitTitle,'" required id="masterCourses" class="my-modal__line">\n                </label>\n                <div class="my-modal__action">\n                    <button type="submit" class="btn custom-bg-dark" id="add-modal__submit">Отправить</button>\n                </div>\n            </form>')}}]),a}(),TeacherExhibitionWork=function(){_inherits(e,InfoBlock);var t=_createSuper(e);function e(){return _classCallCheck(this,e),t.apply(this,arguments)}return _createClass(e,[{key:"col",value:function(t){$.ajax({url:this.url+"?id=".concat(t),method:"get",dataType:"json",async:!1,success:function(t){t.forEach(function(t){$("[data-house__item=".concat(t.id,"] .house__item-edit")).each(function(t,e){var a=$(e).attr("data-edit");"imageURL"!==a&&$("#addForm #".concat(a)).val(e.innerHTML)})})}})}},{key:"cols",get:function(){$.ajax({url:this.url,method:"get",dataType:"json",async:!1,success:function(e){var a=0,o=1,n=$(".carousel-inner");n.text(""),$(".cards .container-xl").text("").append('\n                                                    <h2 class="cards__title" id="cards__title"></h2>'),n.append('                            \n                    <div class="carousel-item active" id="carousel-item-'.concat(o,'">\n                        <div class="row no-gutters"></div>\n                    </div>')),e.forEach(function(t){$("#carousel-item-".concat(o," .row.no-gutters")).append('\n                            <a href="" data-item-title="'.concat(t.title,'" data-id-cards="').concat(t.id,'" class="teacher__cards col-6">\n                                <img class="img-fluid house__item-edit" src="img/').concat(t.teacherImg,'">\n                            </a>')),$(".cards .container-xl").append('\n                        <div class="cards__row row" id="'.concat(t.id,'"></div>\n                    ')),t.exhibitionWork_1&&$("#".concat(t.id)).append('\n                        <div class="col-md-6 text-center">\n                                <img class="cards__img house__item-edit" src="img/'.concat(t.exhibitionWork_1,'" alt="Одна из работа выбранного учителя">\n                            </div>\n                        ')),t.exhibitionWork_2&&$("#".concat(t.id)).append('\n                        <div class="col-md-6 text-center">\n                                <img class="cards__img house__item-edit" src="img/'.concat(t.exhibitionWork_2,'" alt="Одна из работа выбранного учителя">\n                            </div>\n                        ')),t.exhibitionWork_3&&$("#".concat(t.id)).append('\n                        <div class="col-md-6 text-center">\n                                <img class="cards__img house__item-edit" src="img/'.concat(t.exhibitionWork_3,'" alt="Одна из работа выбранного учителя">\n                            </div>\n                        ')),t.exhibitionWork_4&&$("#".concat(t.id)).append('\n                        <div class="col-md-6 text-center">\n                                <img class="cards__img house__item-edit" src="img/'.concat(t.exhibitionWork_4,'" alt="Одна из работа выбранного учителя">\n                            </div>\n                        ')),$("#".concat(t.id)).append('\n                            <div class="house__action _teacher">\n                                <button class="house__action-btn house__action-delete" data-MasterCourse-id="'.concat(t.id,'"><img src="img/icon/delete.png" alt=""></button>\n                                <button class="house__action-btn house__action-edit" data-MasterCourse-id="').concat(t.id,'"><img src="img/icon/edit.png" alt=""></button>\n                                <button class="house__action-btn house__action-add" data-MasterCourse-id="').concat(t.id,'"><img src="img/icon/add-photo.png" alt=""></button>\n                            </div>\n                        ')),$(".cards__row").first().addClass("cards__row_active"),2===++a&&2*o<e.length&&(n.append('                            \n                            <div class="carousel-item" id="carousel-item-'.concat(++o,'">\n                                <div class="row no-gutters"></div>\n                            </div>')),a=0)})}})}}]),e}(),dataPage=$("body").attr("data-page"),dataRole=$("body").attr("data-role");function getFormData(t){return new FormData($(t).get(0))}function createModal(t,e,a,o){var n=$("#".concat(t)),i=$("#".concat(e)),s=$("#my-modal__title"),c=$("#my-modal__subtitle"),r=$("body");$("#addForm").attr("data-type","add"),n.removeClass("h-250"),$(".my-modal__file").css("display","flex"),s.text("".concat(a)),null===o?c.css("display","none"):c.text("".concat(o)),$("#overlay").fadeIn(297,function(){n.css("display","flex").animate({opacity:1},198),null!=e&&i.css("display","block"),r.css("overflow-y","hidden")}),$("#".concat(t," .my-modal__close, #overlay, .my-modal__close-btn")).click(function(){n.animate({opacity:0},198,function(){$(this).css("display","none"),$("#overlay").fadeOut(297)}),null!=e&&i.css("display","none"),r.css("overflow-y","visible")})}function removeError(t){t.css("border","none");var e=t.parent().children(".my-modal__error");e&&e.remove()}function showError(t,e){e.css("border","1px solid red");var a=document.createElement("p");a.classList.add("my-modal__error"),a.textContent=t,e.parent().append(a)}function enableCardsAction(){$(".house__action").each(function(t,e){$(this).css("display","flex")})}function getBtnId(t,e){return t.attr(e)}function initActionDelete(){$(".house__action-delete").click(function(t){t.preventDefault(),DB.delete(getBtnId($(this),"data-MasterCourse-id")),infoBlockInit()})}function initActionEdit(){$(".house__action-edit").click(function(t){createModal("modal","addForm",DB.editTitle,null),DB.col(getBtnId($(this),"data-MasterCourse-id")),$("#addForm").attr("data-info-id",getBtnId($(this),"data-MasterCourse-id")),$(".my-modal__file").css("display","none"),"teacher"===dataPage&&$("#modal").addClass("h-250")})}function initActionAdd(){$(".house__action-add").click(function(t){t.preventDefault(),createModal("modal","addPhotoForm",DB.editTitle,null),DB.col(getBtnId($(this),"data-MasterCourse-id")),$("#addPhotoForm").attr("data-info-id",getBtnId($(this),"data-MasterCourse-id")),"teacher"!==dataPage&&$("#modal").addClass("h-250")})}function infoBlockInit(){DB.cols,"teacher"===dataPage&&($("#cards__title").text("".concat($(".teacher__cards").first().attr("data-item-title"))),teacherCards=$(".teacher__cards")),"admin"===dataRole&&(enableCardsAction(),initActionDelete(),initActionEdit(),initActionAdd(),$("#btnNewHouse").length<1&&($(".main__body").append('<button class="btn d-inline" id="btnNewHouse">Создать новую карточку</button>'),"teacher"!==dataPage&&($("#btnNewHouse").css("background-color",$("#btnSubmit").css("background-color")),$("#newHouse").css("background-color",$(".main").css("background-color")),$("#newPhoto").css("background-color",$(".main").css("background-color")))))}function init(){"masters"===dataPage?(DB=new InfoBlock("Записаться на занятия","Администратор перезвонит Вам, чтобы уточнить удобное время и дату","Создание нового мастер-курса","Обновление мастер курса","../api/masterCourses.php"),Form=new SubmitForm("Введите название мастер-класса","Мастер-курсы")):"courses"===dataPage?(DB=new InfoBlock("Записаться на занятия","Администратор перезвонит Вам, чтобы уточнить удобное время и дату","Создание нового курса","Обновление курса","../api/courses.php"),Form=new SubmitForm("Введите название курса","Курсы")):"design"===dataPage?(DB=new InfoBlock("Записаться на арт-вечеринку","Администратор перезвонит Вам, чтобы уточнить удобное время и дату","Создание нового арт-дизайна","Обновление арт-дизайна","../api/design.php"),Form=new SubmitForm("Введите название арт-вечеринки","Арт-вечеринка")):DB="teacher"===dataPage?new TeacherExhibitionWork("","","Создание нового преподавателя","Обновление преподавателя","../api/teacher.php"):null}function teacherCardsSlide(){teacherCards.click(function(t){t.preventDefault(),$("#cards__title").text("".concat($(this).attr("data-item-title"))),$(".cards__row_active").removeClass("cards__row_active"),$("#".concat($(this).attr("data-id-cards"))).addClass("cards__row_active")})}$(document).ready(function(){init(),infoBlockInit(),null!==DB&&"teacher"!==dataPage?(DB.form,$("#modal").append(Form.form),submitForm=$("#submitForm"),(btnSubmit=$("#btnSubmit")).click(function(t){createModal("modal","submitForm",DB.title,DB.subTitle)}),submitForm.submit(function(t){t.preventDefault();var e,a=!0,o=$("#telephone");removeError(o),Number(o.val())||(removeError(o),showError("Введите номер телефона в следующем формате: 79155552525",o),a=!1),a&&((e=getFormData($(this))).append("submitType",$(this).attr("data-submit-type")),Form.submit(e),$(this).trigger("reset"))})):"teacher"===dataPage&&teacherCardsSlide(),btnAddPhoto=$("#newHouse"),btnNewHouse=$("#btnNewHouse"),submitPhotoForm=$("#addPhotoForm"),submitHouseForm=$("#addForm"),btnNewHouse.click(function(t){createModal("modal","addForm",DB.addTitle,null)}),submitPhotoForm.submit(function(t){t.preventDefault();var e=$("#addPhotoForm").attr("data-info-id"),a=getFormData($(this));a.append("id",e),DB.setImg(a),$(this).trigger("reset"),infoBlockInit()}),submitHouseForm.submit(function(t){t.preventDefault();var e,a,o=getFormData($(this)),n=$("#addForm").attr("data-info-id");"0"===n?DB.new(o,n):(a="teacher"===dataPage?(e=$("#".concat(n," .cards__img")),{id:n,teacherImg:$("[data-id-cards=".concat(n,"] img")).attr("src").slice(5),exhibitionWork_1:$(e[0]).attr("src").slice(5),exhibitionWork_2:$(e[1]).attr("src").slice(5),exhibitionWork_3:$(e[2]).attr("src").slice(5),exhibitionWork_4:$(e[3]).attr("src").slice(5),title:o.get("title")}):{id:submitHouseForm.attr("data-info-id"),title:o.get("title"),tags_1:o.get("tags_1"),tags_2:o.get("tags_2"),tags_3:o.get("tags_3"),text:o.get("text"),imageURL:{name:$("#photo-".concat(n)).attr("data-img")}},DB.editCol(a)),$(this).trigger("reset"),infoBlockInit()})});